# Load libraries
library(ggplot2)
library(scales)

# Load data
df <- read.csv("table1.csv")

# Rename columns
colnames(df) <- c("area", "pop", "acres", "pop_density", "avg_hh_size", "pct_0_vehicles", "pct_1_vehicle", "pct_2_plus_vehicles")

# Ensure vehicle ownership types sum to 100%
vehicle_pct_sum <- df$pct_0_vehicles + df$pct_1_vehicle + df$pct_2_plus_vehicles
df[vehicle_pct_sum < 1, c("pct_0_vehicles", "pct_1_vehicle", "pct_2_plus_vehicles")] <- 
  df[vehicle_pct_sum < 1, c("pct_0_vehicles", "pct_1_vehicle", "pct_2_plus_vehicles")] /
  vehicle_pct_sum[vehicle_pct_sum < 1]

# Calculate vehicle ownership
TWO_PLUS_VEHICLE_ESTIMATE <- 2.5
df$avg_num_cars <- df$pct_2_plus_vehicles * TWO_PLUS_VEHICLE_ESTIMATE + df$pct_1_vehicle
df$avg_num_cars_per_person <- df$avg_num_cars / df$avg_hh_size

# Calculate benefit score
pop_density_normalized <- (df$pop_density - min(df$pop_density)) / (max(df$pop_density) - min(df$pop_density))
cars_per_person_normalized <- (df$avg_num_cars_per_person - min(df$avg_num_cars_per_person)) / (max(df$avg_num_cars_per_person) - min(df$avg_num_cars_per_person))
df$benefit_score <- pop_density_normalized - cars_per_person_normalized

# Generate plot
plot <- ggplot(df, aes(x = pop_density, y = avg_num_cars_per_person, color = benefit_score)) +
  geom_point(size = 3, shape = 21, fill = "blue", color = "black") +
  geom_text(aes(label = area), hjust = 0, vjust = 0, size = 3, color = "black") +
  scale_color_gradientn(colors = c("white", "blue"), values = rescale(c(min(df$benefit_score), max(df$benefit_score)))) +
  labs(title = "Analysis 1: Which Area Would Most Benefit from Transit Investment?",
       x = "Population Density (people per acre)",
       y = "Average Number of Cars per Person",
       color = "Benefit Score") +
  theme_minimal() +
  theme(text = element_text(family = "Arial")) +
  theme(legend.position = "right")

# Save plot
ggsave("analysis1.png", plot = plot, dpi = 300, width = 10, height = 6)
